<!doctype html>
<html>
  <head>
      <link rel="stylesheet" type="text/css" href="stylesheets/main.css">
      <title>Dashboard</title>
  </head>
  <body>
        <div class="row main">
            <div class="col-sm-11 col-md-11" style="margin-left: 40px">
                <div class="panel panel-default">
                    <div class="panel-heading clearfix">
                        <h4 class="panel-title pull-left" style="padding-top: 7.5px;"><strong> Consulta de Documentos </strong></h4>
                    </div>
                    <div id="panel-body" class="panel-body">
                        <form class="form-horizontal">
                            <div class="row">
                                <div class="form-group">
                                    <label  class="col-sm-3 col-md-3 control-label"><h4><strong>Fecha:</strong></h4></label>
                                    <div class="col-sm-6 col-md-6">
                                        <!--<input id="selectorfecha" class="form-control editable" name="selectorfecha" placeholder="ejemplo: AAAA-MM-DD">-->
                                        <div id="selectorfecha"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-sm-2 col-sm-offset-3 col-md-2 col-md-offset-3">
                                        <button id="consultar" class="btn btn-primary editable">
                                            <span class="glyphicon glyphicon-search"></span> Consultar
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!--<div class="form-group">-->

                                <!--<div id="facturasList" class="col-sm-6 col-md-6" style="text-align: center"> <h3><strong>Facturas</strong></h3>-->
                                    <!--&lt;!&ndash;<label for="nombreserver" class="control-label">Selector de Fecha:</label>&ndash;&gt;-->
                                <!--</div>-->
                                <!--<div id="devolicionesList" class="col-sm-6 col-md-6" style="text-align: center"> <h3><strong>Devoluciones</strong></h3>-->
                                    <!--&lt;!&ndash;<label for="nombreserver" class="control-label">Selector de Fecha:</label>&ndash;&gt;-->
                                <!--</div>-->
                            <!--</div>-->
                        </form>
                        <!--<div class="row">-->
                            <!--<ul id="facturasList" class="list-group col-sm-offset-1 col-sm-5 col-md-offset-1 col-md-5">-->
                                <!--<li class="list-group-item active"><h4><strong>Facturas</strong></h4></li>-->
                            <!--</ul>-->
                            <!--<ul id="devolucionesList" class="list-group col-sm-offset-1 col-sm-5 col-md-offset-1 col-md-5">-->
                                <!--<li class="list-group-item active"><h4><strong>Devoluciones</strong></h4></li>-->
                            <!--</ul>-->
                        <!--</div>-->
                    </div>
                </div>
            </div >
        </div>
        <div class="row" style="margin-left: 40px">
            <div class="table-responsive col-sm-11 col-md-5 ">
                <table class="table table-striped">
                    <caption><h4><strong>Facturas</strong></h4></caption>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Cliente</th>
                            <th>N. Art.</th>
                            <th>Fecha</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="facturasList">
                        <tr>
                            <td>--</td>
                            <td>--</td>
                            <td>--</td>
                            <td>--</td>
                            <td>--</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="table-responsive col-sm-11 col-md-5 ">
                <table class="table table-striped">
                    <caption><h4><strong>Devoluciones</strong></h4></caption>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Doc. Ref</th>
                            <th>Cliente</th>
                            <th>N. Art.</th>
                            <th>Fecha</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody id="devolucionesList">
                        <tr>
                            <td>--</td>
                            <td>--</td>
                            <td>--</td>
                            <td>--</td>
                            <td>--</td>
                            <td>--</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
  </body>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/jquery-ui.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="/javascript/lodash.js"></script>
    <script src="/javascript/moment.js"></script>
    <script src="/javascript/jquery-ui.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/jquery.loadingoverlay/latest/loadingoverlay.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        //$("#urlserver").LoadingOverlay("show");
        /*
        if ( $( "#urlserver" ).prop( "disabled" ) )
        {
            console.log('esta disabled');
        }
        */
        var socket = io();
        socket.on('connect', function()
        {
            console.log('connect');
            //$( ".pereto" ).prop( "disabled", false );
            //$.LoadingOverlay("hide");

            socket.on('disconnect', function()
            {
                //$.LoadingOverlay("show");
                console.log('disconnect');
                //$( ".pereto" ).prop( "disabled", true );
            });
        });
        
    </script>  
    <script>
        $( document ).ready(function() 
        {
            $( "#selectorfecha" ).datepicker({
                dateFormat: "yy-mm-dd"
            });
            /*
                Data de configuracion
                    ID_TIENDA -> local
                    NOMBRE_TIENDA -> local
                    RUTA_A2 -> local
                    CODIGO_SEGURIDAD -> servidor
                    NOMBRE_SERVER -> servidor
                    SERVER_URL -> servidor
            */
//            $("#nombreserver").LoadingOverlay("show");
//            $("#urlserver").LoadingOverlay("show");
//            $("#nombretienda").LoadingOverlay("show");
//            $("#codigo").LoadingOverlay("show");
//            $("#rutabd").LoadingOverlay("show");

//            $.get("/config/getconfig", function(data, status)
//            {
//
//                if (data)
//                {
//                    //console.log(data.NOMBRE_SERVER);
//                    $("#nombreserver").val(data.NOMBRE_SERVER);
//                    $("#urlserver").val(data.SERVER_URL);
//
//                    $("#nombretienda").val(data.NOMBRE_TIENDA);
//                    $("#codigo").val(data.CODIGO_SEGURIDAD);
//                    $("#rutabd").val(data.RUTA_A2);
//
//                    $("#nombreserver").LoadingOverlay("hide");
//                    $("#urlserver").LoadingOverlay("hide");
//                    $("#nombretienda").LoadingOverlay("hide");
//                    $("#codigo").LoadingOverlay("hide");
//                    $("#rutabd").LoadingOverlay("hide");
//                    console.log(data.msg);
//                }
//                else
//                {
//                    $(".editable").LoadingOverlay("hide");
//                    $( ".panel-body" ).append( "<div id='error-config' class='alert alert-danger'><strong>Error!</strong> Debes ingresar la configuracion!</div>" );
//                    //alert alert-success
//                    /*
//                        <div class="alert alert-danger">
//                            <strong>Error!</strong> Debes ingresar la configuracion!
//                        </div>
//                    */
//                }
//                     //console.log(data.error);
//                 //$.LoadingOverlay("hide");
//
//            });
        });
    </script>  
    <script>
        $("#consultar").click(function(event)
        {
            event.preventDefault();

            $(".errorQuery").remove();
            $(".facturaItem").remove();
            $(".devolucionItem").remove();

//            $("#facturasList").empty();
//            $("#devolicionesList").empty();

            if ($("#selectorfecha").val() === '')
            {
                $( "#panel-body" ).append( "<div class='errorQuery alert alert-warning'><strong>ERROR! </strong> debes elegir una fecha.</div>" );
                return;
            }

            if (!moment($("#selectorfecha").val()).isValid())
            {
                $( "#panel-body" ).append( "<div class='errorQuery alert alert-warning'><strong>ERROR! </strong> formato de fecha incorrecta..</div>" );
                return;
            }

            $.LoadingOverlay("show");
            $.get( "/api/data/sales/docs/date/"+$("#selectorfecha").val(), function(response) {
                $.LoadingOverlay("hide");
//                var _ = require('lodash');
//                $( "#panel-body" ).append( "<div class='errorQuery alert alert-success'><strong>success!</strong>success.</div>" );
                if (response.data.length == 0)
                {
                    $( "#panel-body" ).append( "<div class='errorQuery alert alert-info'><strong></strong>No existen Facturas para la fecha indicada.</div>" );
                }
                _.forEach(response.data,function (value) {
                    if (value.doc.FTI_TIPO == "11")
                    {
                        //FTI_DOCUMENTOORIGEN
                        $( "#facturasList" ).append( "<tr class='facturaItem'><td>"+value.doc.FTI_DOCUMENTO+"</td><td>"+value.doc.FTI_PERSONACONTACTO+"</td><td>"+value.doc.FTI_TOTALITEMS+"</td><td>"+value.doc.FTI_FECHAEMISION+"</td><td>Bs."+value.doc.FTI_TOTALNETO+"</td></tr>" );
//                        $( "#facturasList" ).append( "<li style='text-align: center' class='facturaItem list-group-item'><button class='btn btn-primary btn-sm editable'><span class='glyphicon glyphicon-eye-open'></span></button> " +
//                            "N°"+value.doc.FTI_DOCUMENTO+"</li>" );
                    }
                    else
                        if(value.doc.FTI_TIPO == "12")
                        {
                            $( "#devolucionesList" ).append( "<tr class='devolucionItem'><td>"+value.doc.FTI_DOCUMENTO+"</td><td>"+value.doc.FTI_DOCUMENTOORIGEN+"</td><td>"+value.doc.FTI_PERSONACONTACTO+"</td><td>"+value.doc.FTI_TOTALITEMS+"</td><td>"+value.doc.FTI_FECHAEMISION+"</td><td>Bs."+value.doc.FTI_TOTALNETO+"</td></tr>" );
                        }
                })
            })
                .done(function() {
//                    $.LoadingOverlay("hide");
//                    $( "#panel-body" ).append( "<div class='errorQuery alert alert-info'><strong>done!</strong>done.</div>" );
                })
                .fail(function(data,error) {
//                    console.log("data=",data)
//                    console.log("error=",data.responseJSON)
                    $.LoadingOverlay("hide");
                    if (data.responseJSON)
                    {
                        if (data.responseJSON.error)
                        {
                            $( "#panel-body" ).append( "<div class='errorQuery alert alert-danger'><strong>ERROR! </strong>"+data.responseJSON.error.msg+"</div>" );
                        }
                        else
                            $( "#panel-body" ).append( "<div class='errorQuery alert alert-danger'><strong>ERROR! </strong> error durante consulta.</div>" );

                    }
                });
//            $.get("/api/data/sales/docs/date/2017-04-02X", function(response,status,error)
//            {
//                $.LoadingOverlay("hide");
//                console.log("response=",response)
//                console.log("status=",status)
//                console.log("error=",error)
//
//                if (response.error)
//                {
//                    $( "#panel-body" ).append( "<div id='errorQuery' class='alert alert-danger'><strong>Error!</strong>Error realizando la consulta.</div>" );
//                }
//                else
//                {
//                    _.forEach(response.data,function (value) {
////                        <label for="nombreserver" class="control-label">value.doc.FTI_DOCUMENTO</label>
//                        if (value.doc.FTI_TIPO == "11")
//                        {
//                            $( "#facturasList" ).append( "<label id='facturaItem' style='text-align: center' class='control-label col-sm-12 col-md-12'>" +
//                                "N°"+value.doc.FTI_DOCUMENTO+"</label>" );
//                        }
//                        else
//                            if(value.doc.FTI_TIPO == "12")
//                            {
//                                $( "#devolicionesList" ).append( "<label id='devolucionItem' style='text-align: center' class='control-label col-sm-12 col-md-12'>" +
//                                    "N°"+value.doc.FTI_DOCUMENTO+" ("+value.doc.FTI_DOCUMENTOORIGEN+")"+"</label>" );
//                            }
//
//                    })
//                }
////
//                //$.LoadingOverlay("show");
//                //alert("Data: " + data + "\nStatus: " + status);
//                //console.log(data);
////                if (data.NOMBRE_SERVER)
////                {
////                    console.log(data.NOMBRE_SERVER);
////                }
////                else
////                     console.log(data.error);
//
//            });
        }); 
//        $("#editar").click(function(event)
//        {
//            event.preventDefault();
//            $("#error-config").remove();
//            //$.LoadingOverlay("show");
//            if ( $( ".editable" ).prop( "disabled" ) )
//            {
//                $( ".editable" ).prop( "disabled", false );
//            }
//            else
//                $( ".editable" ).prop( "disabled", true );
//        });
        /*
        $("#guardar").click(function()
        {
            $.ajax({url: "/getconfig", success: function(result){
                console.log(result);
            }});
        });
        */
        /*
        $(document).ajaxStart(function(){
            $.LoadingOverlay("show");
        });
        $(document).ajaxStop(function(){
            $.LoadingOverlay("hide");
        });   
        */   
    </script>
</html>
