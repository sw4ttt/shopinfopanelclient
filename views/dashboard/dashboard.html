<!DOCTYPE html>
<!-- saved from url=(0050)http://getbootstrap.com/examples/starter-template/ -->
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="http://getbootstrap.com/favicon.ico">

    <title>Dashboard</title>

    <!-- Bootstrap core CSS -->
    <link href="stylesheets/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="stylesheets/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="stylesheets/starter-template.css" rel="stylesheet">
</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Dashboard</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <li class=""><a href="/">Estadisticas</a></li>
                <li class=""><a href="/">Configuracion</a></li>
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class="container">

    <div class="row container-fluid">
        <div class="col-sm-8 col-md-8">
            <div class="panel panel-default">
                <div class="panel-heading clearfix">
                    <h4 class="panel-title pull-left" style="padding-top: 7.5px;"><strong> Consulta de
                        Documentos </strong></h4>
                </div>
                <div id="panel-body" class="panel-body">
                    <form class="form-horizontal">
                        <div class="row">
                            <div class="form-group">
                                <label class="col-sm-3 col-md-3 control-label"><h4><strong>Fecha:</strong></h4></label>
                                <div class="col-sm-6 col-md-6">
                                    <!--<input id="selectorfecha" class="form-control editable" name="selectorfecha" placeholder="ejemplo: AAAA-MM-DD">-->
                                    <div id="selectorfecha"></div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-2 col-sm-offset-3 col-md-2 col-md-offset-3">
                                    <button id="consultar" class="btn btn-primary editable">
                                        <span class="glyphicon glyphicon-search"></span> Consultar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row" style="margin-left: 40px">
        <div class="table-responsive col-sm-12 col-md-6 ">
            <table class="table table-striped table-hover table-condensed">
                <caption><h4><strong>Facturas</strong></h4></caption>
                <thead>
                <tr>
                    <th>#</th>
                    <th>Cliente</th>
                    <th>N. Art.</th>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Total</th>
                </tr>
                </thead>
                <tbody id="facturasList">
                <tr>

                </tr>
                </tbody>
            </table>
        </div>
        <div class="table-responsive col-sm-12 col-md-6 ">
            <table class="table table-striped table-hover table-condensed">
                <caption><h4><strong>Devoluciones</strong></h4></caption>
                <thead>
                <tr>
                    <th>#</th>
                    <th>Doc. Ref</th>
                    <th>Cliente</th>
                    <th>N. Art.</th>
                    <th>Fecha</th>
                    <th>Hora</th>
                    <th>Total</th>
                </tr>
                </thead>
                <tbody id="devolucionesList">
                <tr>

                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div><!-- /.container -->

</body>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="/javascript/jquery.min.js.download"></script>
<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
<script src="/javascript/bootstrap.min.js.download"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="/javascript/ie10-viewport-bug-workaround.js.download"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="/stylesheets/jquery-ui.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="/javascript/lodash.js"></script>
<script src="/javascript/moment.js"></script>
<script src="/javascript/jquery-ui.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.loadingoverlay/latest/loadingoverlay.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
  //$("#urlserver").LoadingOverlay("show");
  /*
   if ( $( "#urlserver" ).prop( "disabled" ) )
   {
   console.log('esta disabled');
   }
   */
  var socket = io()
  socket.on('connect', function () {
    console.log('connect')
    //$( ".pereto" ).prop( "disabled", false );
    //$.LoadingOverlay("hide");

    socket.on('disconnect', function () {
      //$.LoadingOverlay("show");
      console.log('disconnect')
      //$( ".pereto" ).prop( "disabled", true );
    })
  })

</script>
<script>
  $(document).ready(function () {
    $('#selectorfecha').datepicker({
      dateFormat: 'yy-mm-dd'
    })
    /*
     Data de configuracion
     ID_TIENDA -> local
     NOMBRE_TIENDA -> local
     RUTA_A2 -> local
     CODIGO_SEGURIDAD -> servidor
     NOMBRE_SERVER -> servidor
     SERVER_URL -> servidor
     */
    //            $("#nombreserver").LoadingOverlay("show");
    //            $("#urlserver").LoadingOverlay("show");
    //            $("#nombretienda").LoadingOverlay("show");
    //            $("#codigo").LoadingOverlay("show");
    //            $("#rutabd").LoadingOverlay("show");

    //            $.get("/config/getconfig", function(data, status)
    //            {
    //
    //                if (data)
    //                {
    //                    //console.log(data.NOMBRE_SERVER);
    //                    $("#nombreserver").val(data.NOMBRE_SERVER);
    //                    $("#urlserver").val(data.SERVER_URL);
    //
    //                    $("#nombretienda").val(data.NOMBRE_TIENDA);
    //                    $("#codigo").val(data.CODIGO_SEGURIDAD);
    //                    $("#rutabd").val(data.RUTA_A2);
    //
    //                    $("#nombreserver").LoadingOverlay("hide");
    //                    $("#urlserver").LoadingOverlay("hide");
    //                    $("#nombretienda").LoadingOverlay("hide");
    //                    $("#codigo").LoadingOverlay("hide");
    //                    $("#rutabd").LoadingOverlay("hide");
    //                    console.log(data.msg);
    //                }
    //                else
    //                {
    //                    $(".editable").LoadingOverlay("hide");
    //                    $( ".panel-body" ).append( "<div id='error-config' class='alert alert-danger'><strong>Error!</strong> Debes ingresar la configuracion!</div>" );
    //                    //alert alert-success
    //                    /*
    //                        <div class="alert alert-danger">
    //                            <strong>Error!</strong> Debes ingresar la configuracion!
    //                        </div>
    //                    */
    //                }
    //                     //console.log(data.error);
    //                 //$.LoadingOverlay("hide");
    //
    //            });
  })
</script>
<script>
  $('#consultar').click(function (event) {
    event.preventDefault()

    $('.errorQuery').remove()
    $('.facturaItem').remove()
    $('.devolucionItem').remove()

    //            $("#facturasList").empty();
    //            $("#devolicionesList").empty();

    if ($('#selectorfecha').val() === '') {
      $('#panel-body').append('<div class=\'errorQuery alert alert-warning\'><strong>ERROR! </strong> debes elegir una fecha.</div>')
      return
    }

    if (!moment($('#selectorfecha').val()).isValid()) {
      $('#panel-body').append('<div class=\'errorQuery alert alert-warning\'><strong>ERROR! </strong> formato de fecha incorrecta..</div>')
      return
    }

    $.LoadingOverlay('show')
    $.get('/api/sales/docs/date/' + $('#selectorfecha').val(), function (response) {
      $.LoadingOverlay('hide');
      console.log("response=",JSON.stringify(response));
      //                var _ = require('lodash');
      //                $( "#panel-body" ).append( "<div class='errorQuery alert alert-success'><strong>success!</strong>success.</div>" );
      if (response.data.length === 0) {
        $('#panel-body').append('<div class=\'errorQuery alert alert-info\'><strong></strong>No existen Facturas para la fecha indicada.</div>')
      }
      else{
        $('.facturaItem').remove();
        $('.devolucionItem').remove();
        _.forEach(response.data, function (value) {
          if (value.doc.FTI_TIPO.toString() === '11' || value.doc.FTI_TIPO.toString() === '13') {
            //FTI_DOCUMENTOORIGEN
            $('#facturasList').append('<tr class=\'facturaItem\'><td>' + value.doc.FTI_DOCUMENTO + '</td><td>' + (value.doc.FTI_RIFCLIENTE?value.doc.FTI_RIFCLIENTE:"-") + '</td><td>' + "N/A" + '</td><td>' + value.doc.FTI_FECHAEMISION + '</td><td>' + value.doc.FTI_HORA + '</td><td>Bs.' + value.doc.FTI_TOTALNETO + '</td></tr>')
            //                        $( "#facturasList" ).append( "<li style='text-align: center' class='facturaItem list-group-item'><button class='btn btn-primary btn-sm editable'><span class='glyphicon glyphicon-eye-open'></span></button> " +
            //                            "N°"+value.doc.FTI_DOCUMENTO+"</li>" );
          }
          else
            if(value.doc.FTI_TIPO.toString() === '12' || value.doc.FTI_TIPO.toString() === '17'){
            $('#devolucionesList').append('<tr class=\'devolucionItem\'><td>' + value.doc.FTI_DOCUMENTO + '</td><td>' + "N/A" + '</td><td>' + (value.doc.FTI_RIFCLIENTE?value.doc.FTI_RIFCLIENTE:"-") + '</td><td>' + "N/A" + '</td><td>' + value.doc.FTI_FECHAEMISION + '</td><td>' + value.doc.FTI_HORA + '</td><td>Bs.' + value.doc.FTI_TOTALNETO + '</td></tr>')
          }
        })
      }

    })
      .done(function () {
        //                    $.LoadingOverlay("hide");
        //                    $( "#panel-body" ).append( "<div class='errorQuery alert alert-info'><strong>done!</strong>done.</div>" );
      })
      .fail(function (data, error) {
        //                    console.log("data=",data)
        //                    console.log("error=",data.responseJSON)
        $.LoadingOverlay('hide')
        if (data.responseJSON) {
          if (data.responseJSON.error) {
            $('#panel-body').append('<div class=\'errorQuery alert alert-danger\'><strong>ERROR! </strong>' + data.responseJSON.error.msg + '</div>')
          }
          else
            $('#panel-body').append('<div class=\'errorQuery alert alert-danger\'><strong>ERROR! </strong> error durante consulta.</div>')

        }
      })
    //            $.get("/api/data/sales/docs/date/2017-04-02X", function(response,status,error)
    //            {
    //                $.LoadingOverlay("hide");
    //                console.log("response=",response)
    //                console.log("status=",status)
    //                console.log("error=",error)
    //
    //                if (response.error)
    //                {
    //                    $( "#panel-body" ).append( "<div id='errorQuery' class='alert alert-danger'><strong>Error!</strong>Error realizando la consulta.</div>" );
    //                }
    //                else
    //                {
    //                    _.forEach(response.data,function (value) {
    ////                        <label for="nombreserver" class="control-label">value.doc.FTI_DOCUMENTO</label>
    //                        if (value.doc.FTI_TIPO == "11")
    //                        {
    //                            $( "#facturasList" ).append( "<label id='facturaItem' style='text-align: center' class='control-label col-sm-12 col-md-12'>" +
    //                                "N°"+value.doc.FTI_DOCUMENTO+"</label>" );
    //                        }
    //                        else
    //                            if(value.doc.FTI_TIPO == "12")
    //                            {
    //                                $( "#devolicionesList" ).append( "<label id='devolucionItem' style='text-align: center' class='control-label col-sm-12 col-md-12'>" +
    //                                    "N°"+value.doc.FTI_DOCUMENTO+" ("+value.doc.FTI_DOCUMENTOORIGEN+")"+"</label>" );
    //                            }
    //
    //                    })
    //                }
    ////
    //                //$.LoadingOverlay("show");
    //                //alert("Data: " + data + "\nStatus: " + status);
    //                //console.log(data);
    ////                if (data.NOMBRE_SERVER)
    ////                {
    ////                    console.log(data.NOMBRE_SERVER);
    ////                }
    ////                else
    ////                     console.log(data.error);
    //
    //            });
  })
  //        $("#editar").click(function(event)
  //        {
  //            event.preventDefault();
  //            $("#error-config").remove();
  //            //$.LoadingOverlay("show");
  //            if ( $( ".editable" ).prop( "disabled" ) )
  //            {
  //                $( ".editable" ).prop( "disabled", false );
  //            }
  //            else
  //                $( ".editable" ).prop( "disabled", true );
  //        });
  /*
   $("#guardar").click(function()
   {
   $.ajax({url: "/getconfig", success: function(result){
   console.log(result);
   }});
   });
   */
  /*
   $(document).ajaxStart(function(){
   $.LoadingOverlay("show");
   });
   $(document).ajaxStop(function(){
   $.LoadingOverlay("hide");
   });
   */
</script>

</html>